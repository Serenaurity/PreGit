<!-- templates/myapp/dashboard.html -->
{% extends 'myapp/base.html' %}
{% block title %}แดชบอร์ด - CareME{% endblock %}
{% block content %}
<div class="container mx-auto py-6">
    <h1 class="text-2xl font-bold mb-6">แดชบอร์ด</h1>
    
    <!-- สรุปข้อมูลผู้ใช้ -->
    <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
        <div class="flex items-center mb-4">
            <div class="bg-blue-100 p-3 rounded-full mr-4">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <div>
                <h2 class="text-lg font-semibold">ยินดีต้อนรับ, {{ user.username }}</h2>
                <p class="text-sm text-gray-600">{{ user.email }}</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- สถานะสมาชิก -->
            <div>
                <h3 class="text-sm font-medium text-gray-500">สถานะสมาชิก</h3>
                {% if active_subscription %}
                    <p class="mt-1 flex items-center">
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                        <span>{{ active_subscription.get_plan_name_display }} (เหลือ {{ active_subscription.remaining_days }} วัน)</span>
                    </p>
                {% else %}
                    <p class="mt-1 flex items-center">
                        <span class="w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
                        <span>ไม่มีแพ็คเกจที่ใช้งานอยู่</span>
                    </p>
                {% endif %}
            </div>
            
            <!-- ข้อมูลสุขภาพ -->
            <div>
                <h3 class="text-sm font-medium text-gray-500">ข้อมูลสุขภาพล่าสุด</h3>
                {% if user_profile %}
                    <p class="mt-1">น้ำหนัก: {{ user_profile.weight }} กก., ส่วนสูง: {{ user_profile.height }} ซม.</p>
                {% else %}
                    <p class="mt-1 text-gray-500">ยังไม่มีข้อมูล</p>
                {% endif %}
            </div>
            
            <!-- กิจกรรมล่าสุด -->
            <div>
                <h3 class="text-sm font-medium text-gray-500">กิจกรรมล่าสุด</h3>
                <p class="mt-1">
                    {% if last_activity %}
                        {{ last_activity }}
                    {% else %}
                        ยังไม่มีกิจกรรม
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    
    <!-- แผนสุขภาพ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <!-- แผนออกกำลังกาย -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="flex items-center mb-4">
                <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                </div>
                <h2 class="text-lg font-semibold">แผนออกกำลังกาย</h2>
            </div>
            
            {% if exercise_plan %}
                <div class="mb-3">
                    <p class="text-sm text-gray-600">เป้าหมาย: {{ exercise_plan.get_goal_display }}</p>
                    <p class="text-sm text-gray-600">ระดับ: {{ exercise_plan.get_level_display }}</p>
                    
                    {% if today_workout %}
                        <div class="mt-3 bg-blue-50 p-3 rounded-lg">
                            {% if today_workout.focus == 'rest' %}
                                <p class="font-medium">วันนี้: วันพักผ่อน</p>
                            {% else %}
                                <p class="font-medium">วันนี้: {{ today_workout.get_focus_display }}</p>
                                <a href="{% url 'view_workout_day' today_workout.id %}" class="text-blue-600 hover:underline text-sm inline-block mt-1">ดูรายละเอียด</a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                <a href="{% url 'view_exercise_plan' %}" class="bg-blue-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-blue-700 transition">ดูแผนทั้งหมด</a>
            {% else %}
                <p class="text-sm text-gray-600 mb-3">คุณยังไม่มีแผนออกกำลังกาย</p>
                {% if active_subscription %}
                    <a href="{% url 'exercise_plan' %}" class="bg-blue-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-blue-700 transition">สร้างแผนออกกำลังกาย</a>
                {% else %}
                    <a href="{% url 'subscription_list' %}" class="bg-blue-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-blue-700 transition">สมัครสมาชิกเพื่อสร้างแผน</a>
                {% endif %}
            {% endif %}
        </div>
        
        <!-- แผนอาหาร -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="flex items-center mb-4">
                <div class="bg-green-100 p-2 rounded-full mr-3">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h2 class="text-lg font-semibold">แผนอาหาร</h2>
            </div>
            
            {% if meal_plan %}
                <div class="mb-3">
                    <p class="text-sm text-gray-600">เป้าหมาย: {{ meal_plan.get_goal_display }}</p>
                    <p class="text-sm text-gray-600">แคลอรี่: {{ meal_plan.daily_calories }} แคลอรี่/วัน</p>
                    
                    {% if today_meal %}
                        <div class="mt-3 bg-green-50 p-3 rounded-lg">
                            <p class="font-medium">แผนอาหารวันนี้:</p>
                            <a href="{% url 'view_daily_meal' today_meal.id %}" class="text-green-600 hover:underline text-sm inline-block mt-1">ดูรายละเอียด</a>
                        </div>
                    {% endif %}
                </div>
                <a href="{% url 'view_meal_plan' %}" class="bg-green-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-green-700 transition">ดูแผนทั้งหมด</a>
            {% else %}
                <p class="text-sm text-gray-600 mb-3">คุณยังไม่มีแผนอาหาร</p>
                {% if active_subscription %}
                    <a href="{% url 'meal_plan' %}" class="bg-green-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-green-700 transition">สร้างแผนอาหาร</a>
                {% else %}
                    <a href="{% url 'subscription_list' %}" class="bg-green-600 text-white px-4 py-2 rounded text-sm inline-block hover:bg-green-700 transition">สมัครสมาชิกเพื่อสร้างแผน</a>
                {% endif %}
            {% endif %}
        </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- รายการสั่งซื้อล่าสุด -->
        <div class="md:col-span-2 bg-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">รายการสั่งซื้อล่าสุด</h2>
                <a href="{% url 'order_history' %}" class="text-blue-600 hover:underline text-sm">ดูทั้งหมด</a>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัสสั่งซื้อ</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ราคารวม</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for order in recent_orders %}
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    <a href="{% url 'order_detail' order.id %}" class="text-blue-600 hover:underline">
                                        {{ order.order_number }}
                                    </a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                    {{ order.created_at|date:"d/m/Y" }}
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                                    {{ order.total_price|floatformat:2 }} บาท
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                        {% if order.status == 'completed' %}bg-green-100 text-green-800
                                        {% elif order.status == 'processing' %}bg-blue-100 text-blue-800
                                        {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {{ order.get_status_display }}
                                    </span>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="px-4 py-4 text-sm text-gray-500 text-center">
                                    ยังไม่มีรายการสั่งซื้อ
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ลิงก์ด่วน -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-lg font-semibold mb-4">เมนูลัด</h2>
            
            <div class="space-y-2">
                <a href="{% url 'profile_update' %}" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <span>แก้ไขโปรไฟล์</span>
                </a>
                
                <a href="{% url 'password_change' %}" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="bg-yellow-100 p-2 rounded-full mr-3">
                        <svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                        </svg>
                    </div>
                    <span>เปลี่ยนรหัสผ่าน</span>
                </a>
                
                <a href="{% url 'wishlist' %}" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="bg-red-100 p-2 rounded-full mr-3">
                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <span>รายการโปรด</span>
                </a>
                
                <a href="{% url 'subscription_list' %}" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="bg-purple-100 p-2 rounded-full mr-3">
                        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                        </svg>
                    </div>
                    <span>ยกระดับแพ็คเกจ</span>
                </a>
                
                <a href="{% url 'support' %}" class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition">
                    <div class="bg-green-100 p-2 rounded-full mr-3">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </div>
                    <span>ติดต่อช่วยเหลือ</span>
                </a>
            </div>
        </div>
    </div>
    
    <!-- บทความแนะนำ -->
    <div class="mt-6 bg-white p-6 rounded-lg shadow-lg">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold">บทความแนะนำสำหรับคุณ</h2>
            <a href="{% url 'content_list' %}" class="text-blue-600 hover:underline text-sm">ดูทั้งหมด</a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for article in recommended_articles %}
                <div class="rounded-lg overflow-hidden shadow border">
                    {% if article.image %}
                        <img src="{{ article.image.url }}" alt="{{ article.title }}" class="w-full h-48 object-cover">
                    {% else %}
                        <div class="bg-gray-200 h-48 flex items-center justify-center">
                            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    {% endif %}
                    <div class="p-4">
                        <span class="text-xs bg-blue-100 text-blue-800 rounded-full px-2 py-1">{{ article.get_category_display }}</span>
                        <h3 class="text-lg font-semibold mt-2">{{ article.title }}</h3>
                        <p class="text-sm text-gray-600 line-clamp-2 mt-1">{{ article.excerpt }}</p>
                        <div class="mt-3">
                            <a href="{% url 'content_detail' article.slug %}" class="text-blue-600 hover:underline text-sm">อ่านต่อ &rarr;</a>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="md:col-span-3 p-6 text-center text-gray-500">
                    ยังไม่มีบทความแนะนำ
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}